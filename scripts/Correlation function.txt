##Define source file path
setwd("C:")

##call libraries
library(readxl)
library(openxlsx)
library(tidyverse)
##import files
#expression
DEGs <- read.csv("DEGs.txt")
DEGs <- unique(DEGs)
#methylation
DMGs <- read.csv("DMGs.txt")
DMGs<-unique(DMGs)
#miRNA
DEIMR <- read_table("DEIMR.txt")
miRNA <- read_excel("miRNA.xlsx")
target_miRNA  <- read.csv("microrna_target.txt", sep="")
DEIMR_G<-merge(target_miRNA,DEIMR, by.x = "miRNA", by.y = "miRNA")
DEIMRG =select(DEIMR_G,-1)
DEIMRG<-unique(DEIMRG)

number_DEGs <- nrow(DEGs)-1
number_DMGs <- nrow(DMGs)-1
number_DEIMR_G <- nrow(DEIMRG)-1

#ex vs met
inter_DEGs_DMGs<-merge(DEGs,DMGs, by.x = "gene", by.y = "gene")
DEGs_vs_DMGs <- nrow(inter_DEGs_DMGs)
#ex vs mir
inter_DEGs_DEIMRG<-merge(DEGs,DEIMRG, by.x = "gene", by.y = "gene")
DEGs_vs_DEIMRG <- nrow(inter_DEGs_DEIMRG)

#met vs mir
inter_DMGs_DEIMRG<-merge(DMGs,DEIMRG, by.x = "gene", by.y = "gene")
DMGs_vs_DEIMRG <- nrow(inter_DMGs_DEIMRG)
#intersection

inter_DEGs_DMGs_DEIMRG<-merge(inter_DEGs_DMGs,inter_DEGs_DEIMRG, by.x = "gene", by.y = "gene")
DEGs_vs_DMGs_vsDEIMRG <- nrow(inter_DEGs_DMGs_DEIMRG)

#summary
#numbers
result <- data.frame(number_DEGs,number_DMGs,number_DEIMR_G,DEGs_vs_DMGs_vsDEIMRG,DEGs_vs_DMGs,DEGs_vs_DEIMRG,DMGs_vs_DEIMRG)
result<- as.data.frame(t(result))
Data_Intersection<-rename(result,Intersection=c(1))

#genes
a1 <- data.frame(inter_DEGs_DMGs_DEIMRG)%>%
  rename (DEGs_vs_DMGs_vs_DEIMRG=gene)
a2 <- data.frame(inter_DEGs_DMGs)%>%
  rename(DEGs_vs_DGMs=gene)
a3 <- data.frame(inter_DEGs_DEIMRG)%>%
  rename(DEGs_vs_DEIMRG=gene)
a4 <- data.frame(inter_DMGs_DEIMRG)%>%
  rename(DMGs_vs_DEIMRG=gene)

Genes_Differential_Profile <-bind_rows(a1,a2,a3,a4)

##export data
#number table
write.table(Data_Intersection, "Correlation_between_DEGs_DMGs_and_DEIMRG.txt", sep=",")
#gene tables

data_list <- list("DEGs_vs_DMGs_vs_DEIMRG" = inter_DEGs_DMGs_DEIMRG,
                  "DEGs_vs_DGMs" = inter_DEGs_DMGs,
                  "DEGs_vs_DEIMRG" =inter_DEGs_DEIMRG,
                  "DMGs_vs_DEIMRG" = inter_DMGs_DEIMRG)
write.xlsx(data_list, "Genes_Differential_Profile.xlsx")



##Show
Data_Intersection
Genes_Differential_Profile







